from typing import List, Dict
from extract_sum_mp import mass_extract_summaries
from cluster import LogosCluster
import marqo
import json

'''
This file contains the SumDB class, which is responsible for storing summarized vectors and querying similar content.
'''


class SumDB:
    def __init__(self):
        self.host = 'localhost'
        self.port = 8882

        # set up Marqo connector
        self.db = marqo.Client(url=f'http://{self.host}:{self.port}')

        # Only create index if it does not exist
        index_name = 'one_node_sumdb'
        try:
            self.db.create_index(index_name, model="hf/e5-base-v2")
        except:
            pass
        self.index = self.db.index(index_name)

    def insert(self, vectors: List[Dict[str, str]], CHUNK_SIZE: int = 128) -> bool:
        '''
        Insert summarized vectors into SumDB in chunks

        NOTE that maximum chunk size is 128

        Vector data structure:
        {
            'row_id': 'unique_id',
            'summary': 'content_text',
            'topic': 'topic_name',
        }
        '''
        try:
            for i in range(0, len(vectors), CHUNK_SIZE):
                batch = vectors[i:i + CHUNK_SIZE]
                self.index.add_documents(batch, tensor_fields=['summary'])

            return True

        except Exception as e:
            print(f'Error at SumDB insert: {e}')
            return False

    def query(self, query_vector: str, top_k: int = 5) -> List[Dict[str, str]]:
        '''
        Query similar content from SumDB, only output top results with highest similarity score
        '''
        try:
            return self.index.search(
                q=query_vector,
                limit=top_k
            )['hits']

        except Exception as e:
            print(f'Error at SumDB query: {e}')
            return []

    def query_all(self, top_k: int = 5) -> List[Dict[str, str]]:
        '''
        Query all content from SumDB, only output top results with highest similarity score
        '''
        try:
            return self.index.search(
                q='*',
                limit=top_k
            )['hits']

        except Exception as e:
            print(f'Error at SumDB query_all: {e}')
            return []

    def delete_all(self) -> bool:
        '''
        Delete all vectors from SumDB by actual ID, not row_id
        '''
        try:
            all_docs = self.index.search(
                q='', limit=128)  # Adjust limit as needed
            while len(all_docs['hits']) > 0:
                id_set = []
                for hit in all_docs['hits']:
                    id_set.append(hit['_id'])
                print(f'Deleting {len(id_set)} documents')
                self.index.delete_documents(id_set)
                
                all_docs = self.index.search(q='', limit=128)

            return True

        except Exception as e:
            print(f'Error at SumDB delete_all: {e}')
            return False

    def summarize_node(self, node: str, cluster: LogosCluster, CHUNK_SIZE: int = 128) -> bool:
        '''
        Summarize content from a single node in the cluster
        '''
        try:
            # Divide data into chunks to avoid memory overload
            count = 0
            for chunk in cluster.query_chunk(node, CHUNK_SIZE):
                insert_data = []
                print(f'[INFO] Summarizing chunk {count}...')
                # Each chunk is a list of rows (ID: int, Content: str, UpdatedAt: datetime)
                # For each chunk, summarize the content
                summaries = mass_extract_summaries([row[1] for row in chunk])

                # Then modified the chunk with summarized content
                for summary, row in zip(summaries, chunk):
                    insert_data.append(
                        {'row_id': row[0], 'summary': summary, 'topic': node})

                # Finally insert summarized data into SumDB
                self.insert(insert_data, CHUNK_SIZE)

                print(f'[INFO] Finished summarizing chunk {count}')
                count += 1

            return True

        except Exception as e:
            print(f'Error at SumDB summarize_node: {e}')
            return False

    def summarize_cluster(self, cluster: LogosCluster, CHUNK_SIZE: int = 128) -> bool:
        '''
        Summarize all content from the cluster to SumDB
        '''
        try:
            # Query data from each node and summarize
            for node in cluster.nodes:
                print(f'[INFO] Processing node {node}')
                insert_status = self.summarize_node(node, cluster, CHUNK_SIZE)

                if not insert_status:
                    return False

                print(f'[INFO] Node {node} summarized successfully')

            return True

        except Exception as e:
            print(f'Error at SumDB summarize_cluster: {e}')
            return False


if __name__ == '__main__':
    import time
    from rich import print
    start = time.perf_counter()
    sumdb = SumDB()
    # print('Inserting data...')
    # sumdb.insert(
    #     [
    #         {'row_id': '1', 'summary': 'This is a test', 'topic': 'test'},
    #         {'row_id': '2', 'summary': 'This is another test', 'topic': 'test'},
    #         {'row_id': '3', 'summary': 'This is 2nd testing scenario', 'topic': 'test'},
    #     ]
    # )
    # query = 'anxiety unpleasant complex combination of emotions anxiety is an emotion which is characterized by an unpleasant state of inner turmoil and includes feelings of dread over anticipated events it is often accompanied by nervous behavior such as pacing back and forth somatic complaints and rumination anxiety is a feeling of uneasiness and worry usually generalized and unfocused as an overreaction to a situation that is only subjectively seen as menacing it is often accompanied by muscular tension restlessness fatigue inability to catch ones breath tightness in the abdominal region nausea and problems in concentration anxiety is closely related to fear which is a response to a real or perceived immediate threat fight or flight response anxiety involves the expectation of future threat including dread people facing anxiety may withdraw from situations which have provoked anxiety in the past though anxiety is a typical human response when excessive or persisting beyond developmentally appropriate periods it may be diagnosed as an anxiety disorder there are multiple forms of anxiety disorder such as generalized anxiety disorder and obsessive compulsive disorder with specific clinical definitions part of the definition of an anxiety disorder which distinguishes it from everyday anxiety is that it is persistent typically lasting 6 months or more although the criterion for duration is intended as a general guide with allowance for some degree of flexibility and is sometimes of shorter duration in children anxiety is an emotion which is characterized by an unpleasant state of inner turmoil and includes feelings of dread over anticipated events it is often accompanied by nervous behavior such as pacing back and forth somatic complaints and rumination anxiety is a feeling of uneasiness and worry usually generalized and unfocused as an overreaction to a situation that is only subjectively seen as menacing it is often accompanied by muscular tension restlessness fatigue inability to catch ones breath tightness in the abdominal region nausea and problems in concentration anxiety is closely related to fear which is a response to a real or perceived immediate threat fight or flight response anxiety involves the expectation of future threat including dread people facing anxiety may withdraw from situations which have provoked anxiety in the past though anxiety is a typical human response when excessive or persisting beyond developmentally appropriate periods it may be diagnosed as an anxiety disorder there are multiple forms of anxiety disorder such as generalized anxiety disorder and obsessive compulsive disorder with specific clinical definitions part of the definition of an anxiety disorder which distinguishes it from everyday anxiety is that it is persistent typically lasting 6 months or more although the criterion for duration is intended as a general guide with allowance for some degree of flexibility and is sometimes of shorter duration in children anxiety vs fear anxiety is distinguished from fear which is an appropriate cognitive and emotional response to a perceived threatandreas dorschel furcht und angst in dietmar goltschnigg ed angst lhmender stillstand und motor des fortschritts stauffenburg tbingen 2012 pp 4954 anxiety is related to the specific behaviors of fightorflight responses defensive behavior or escape there is a false presumption that often circulates that anxiety only occurs in situations perceived as uncontrollable or unavoidable but this is not always so david barlow defines anxiety as a futureoriented mood state in which one is not ready or prepared to attempt to cope with upcoming negative events and that it is a distinction between future and present dangers which divides anxiety and fear another description of anxiety is agony dread terror or even apprehension in positive psychology anxiety is described as the mental state that results from a difficult challenge for which the subject has insufficient coping skills fear and anxiety can be differentiated into four domains 1 duration of emotional experience 2 temporal focus 3 specificity of the threat and 4 motivated direction fear is shortlived presentfocused geared towards a specific threat and facilitating escape from threat on the other hand anxiety is longacting futurefocused broadly focused towards a diffuse threat and promoting excessive caution while approaching a potential threat and interferes with constructive coping joseph e ledoux and lisa feldman barrett have both sought to separate automatic threat responses from additional associated cognitive activity within anxiety symptoms anxiety can be experienced with long drawnout daily symptoms that reduce quality of life known as chronic or generalized anxiety or it can be experienced in short spurts with sporadic stressful panic attacks known as acute anxiety symptoms of anxiety can range in number intensity and frequency depending on the person while almost everyone has experienced anxiety at some point in their lives most do not develop longterm problems with anxiety anxiety may cause psychiatric and physiological symptoms the risk of anxiety leading to depression could possibly even lead to an individual harming themselves which is why there are many 24hour suicide prevention hotlines the behavioral effects of anxiety may include withdrawal from situations which have provoked anxiety or negative feelings in the past other effects may include changes in sleeping patterns changes in habits increase or decrease in food intake and increased motor tension such as foot tapping the emotional effects of anxiety may include feelings of apprehension or dread trouble concentrating feeling tense or jumpy anticipating the worst irritability restlessness watching and waiting for signs and occurrences of danger and feeling like your minds gone blank as well as nightmaresbad dreams obsessions about sensations dj vu a trappedinyourmind feeling and feeling like everything is scary it may include a vague experience and feeling of helplessness the cognitive effects of anxiety may include thoughts about suspected dangers such as fear of dying you mayÂ  fear that the chest pains are a deadly heart attack or that the shooting pains in your head are the result of a tumor or an aneurysm you feel an intense fear when you think of dying or you may think of it more often than normal or cant get it out of your mind the physiological symptoms of anxiety may include neurological as headache paresthesias fasciculations vertigo or presyncope digestive as abdominal pain nausea diarrhea indigestion dry mouth or bolus stress hormones released in an anxious state have an impact on bowel function and can manifest physical symptoms that may contribute to or exacerbate ibs respiratory as shortness of breath or sighing breathing cardiac as palpitations tachycardia or chest pain muscular as fatigue tremors or tetany cutaneous as perspiration or itchy skin urogenital as frequent urination urinary urgency dyspareunia or impotence chronic pelvic pain syndrome types there are various types of anxiety existential anxiety can occur when a person faces angst an existential crisis or nihilistic feelings people can also face mathematical anxiety somatic anxiety stage fright or test anxiety social anxiety refers to a fear of rejection and negative evaluation being judged by other people existential the philosopher sren kierkegaard in the concept of anxiety 1844 described anxiety or dread associated with the dizziness of freedom and suggested the possibility for positive resolution of anxiety through the selfconscious exercise of responsibility and choosing in art and artist 1932 the psychologist otto rank wrote that the psychological trauma of birth was the preeminent human symbol of existential anxiety and encompasses the creative persons simultaneous fear of  and desire for  separation individuation and differentiation the theologian paul tillich characterized existential anxiety as the state in which a being is aware of its possible nonbeing and he listed three categories for the nonbeing and resulting anxiety ontic fate and death moral guilt and condemnation and spiritual emptiness and meaninglessness according to tillich the last of these three types of existential anxiety ie spiritual anxiety is predominant in modern times while the others were predominant in earlier periods tillich argues that this anxiety can be accepted as part of the human condition or it can be resisted but with negative consequences in its pathological form spiritual anxiety may tend to drive the person toward the creation of certitude in systems of meaning which are supported by tradition and authority even though such undoubted certitude is not built on the rock of reality according to viktor frankl the author of mans search for meaning when a person is faced with extreme mortal dangers the most basic of all human wishes is to find a meaning of life to combat the trauma of nonbeing as death is near depending on the source of the threat psychoanalytic theory distinguishes the following types of anxiety  realistic  neurotic  moral test and performance according to yerkesdodson law an optimal level of arousal is necessary to best complete a task such as an exam performance or competitive event however when the anxiety or level of arousal exceeds that optimum the result is a decline in performance test anxiety is the uneasiness apprehension or nervousness felt by students who have a fear of failing an exam students who have test anxiety may experience any of the following the association of grades with personal worth fear of embarrassment by a teacher fear of alienation from parents or friends time pressures or feeling a loss of control sweating dizziness headaches racing heartbeats nausea fidgeting uncontrollable crying or laughing and drumming on a desk are all common because test anxiety hinges on fear of negative evaluation debate exists as to whether test anxiety is itself a unique anxiety disorder or whether it is a specific type of social phobia the dsmiv classifies test anxiety as a type of social phobia while the term test anxiety refers specifically to students many workers share the same experience with regard to their career or profession the fear of failing at a task and being negatively evaluated for failure can have a similarly negative effect on the adult management of test anxiety focuses on achieving relaxation and developing mechanisms to manage anxiety test anxiety remains a challenge for students and has considerable physiological and psychological impacts the routine practice of slow deviceguided breathing dgb is a major component of behavioral treatments for anxiety conditions  stranger social and intergroup anxiety humans generally require social acceptance and thus sometimes dread the disapproval of others apprehension of being judged by others may cause anxiety in social environments anxiety during social interactions particularly between strangers is common among young people it may persist into adulthood and become social anxiety or social phobia stranger anxiety in small children is not considered a phobia in adults an excessive fear of other people is not a developmentally common stage it is called social anxiety according to cutting social phobics do not fear the crowd but the fact that they may be judged negatively social anxiety varies in degree and severity for some people it is characterized by experiencing discomfort or awkwardness during physical social contact eg embracing shaking hands etc while in other cases it can lead to a fear of interacting with unfamiliar people altogether those with this condition may restrict their lifestyles to accommodate the anxiety minimizing social interaction whenever possible social anxiety also forms a core aspect of certain personality disorders including avoidant personality disorder to the extent that a person is fearful of social encounters with unfamiliar others some people may experience anxiety particularly during interactions with outgroup members or people who share different group memberships ie by race ethnicity class gender etc depending on the nature of the antecedent relations cognitions and situational factors intergroup contact may be stressful and lead to feelings of anxiety this apprehension or fear of contact with outgroup members is often called interracial or intergroup anxiety as is the case with the more generalized forms of social anxiety intergroup anxiety has behavioral cognitive and affective effects for instance increases in schematic processing and simplified information processing can occur when anxiety is high indeed such is consistent with related work on attentional bias in implicit memory additionally recent research has found that implicit racial evaluations ie automatic prejudiced attitudes can be amplified during intergroup interaction negative experiences have been illustrated in producing not only negative expectations but also avoidant or antagonistic behavior such as hostility furthermore when compared to anxiety levels and cognitive effort eg impression management and selfpresentation in intragroup contexts levels and depletion of resources may be exacerbated in the intergroup situation trait anxiety can be either a shortterm state or a longterm personality trait trait anxiety reflects a stable tendency across the lifespan of responding with acute state anxiety in the anticipation of threatening situations whether they are actually deemed threatening or not a metaanalysis showed that a high level of neuroticism is a risk factor for development of anxiety symptoms and disorders such anxiety may be conscious or unconscious personality can also be a trait leading to anxiety and depression through experience many find it difficult to collect themselves due to their own personal nature  choice or decision  anxiety induced by the need to choose between similar options is increasingly being recognized as a problem for individuals and for organizations in 2004 capgemini wrote today were all faced with greater choice more competition and less time to consider our options or seek out the right adviceis choice anxiety costing british blue chip business  capgemini august 16 2004 in a decision context unpredictability or uncertainty may trigger emotional responses in anxious individuals that systematically alter decisionmaking there are primarily two forms of this anxiety type the first form refers to a choice in which there are multiple potential outcomes with known or calculable probabilities the second form refers to the uncertainty and ambiguity related to a decision context in which there are multiple possible outcomes with unknown probabilities panic disorder panic disorder may share symptoms of stress and anxiety but it is actually very different panic disorder is an anxiety disorder that occurs without any triggers according to the us department of health and human services this disorder can be distinguished by unexpected and repeated episodes of intense fear someone with panic disorder will eventually develop constant fear of another attack and as this progresses it will begin to affect daily functioning and an individuals general quality of life it is reported by the cleveland clinic that panic disorder affects 2 to 3 percent of adult americans and can begin around the time of the teenage and early adult years some symptoms include difficulty breathing chest pain dizziness trembling or shaking feeling faint nausea fear that you are losing control or are about to die even though they have these symptoms during an attack the main symptom is the persistent fear of having future panic attacks anxiety disorders anxiety disorders are a group of mental disorders characterized by exaggerated feelings of anxiety and fear responses anxiety is a worry about future events and fear is a reaction to current events these feelings may cause physical symptoms such as a fast heart rate and shakiness there are a number of anxiety disorders including generalized anxiety disorder specific phobia social anxiety disorder separation anxiety disorder agoraphobia panic disorder and selective mutism the disorder differs by what results in the symptoms people often have more than one anxiety disorder anxiety disorders are caused by a complex combination of genetic and environmental factors to be diagnosed symptoms typically need to be present for at least six months be more than would be expected for the situation and decrease a persons ability to function in their daily lives other problems that may result in similar symptoms include hyperthyroidism heart disease caffeine alcohol or cannabis use and withdrawal from certain drugs among others without treatment anxiety disorders tend to remain treatment may include lifestyle changes counselling and medications counselling is typically with a type of cognitive behavioural therapy medications such as antidepressants or beta blockers may improve symptoms about 12 of people are affected by an anxiety disorder in a given year and between 1230 are affected at some point in their life they occur about twice as often in women than they do in men and generally begin before the age of 25 the most common are specific phobia which affects nearly 12 and social anxiety disorder which affects 10 at some point in their life they affect those between the ages of 15 and 35 the most and become less common after the age of 55 rates appear to be higher in the united states and europe short and longterm anxiety anxiety can be either a shortterm state or a longterm trait whereas trait anxiety represents worrying about future events anxiety disorders are a group of mental disorders characterized by feelings of anxiety and fears four ways to be anxious in his book anxious the modern mind in the age of anxiety joseph ledoux examines four experiences of anxiety through a brainbased lens  in the presence of an existing or imminent external threat you worry about the event and its implications for your physical andor psychological wellbeing when a threat signal occurs it signifies either that danger is present or near in space and time or that it might be coming in the future nonconscious threats processing by the brain activates defensive survival circuits resulting in changes in information processing in the brain controlled in part by increases in arousal and behavioral and physiological responses in the body that then produce signals that feed back to the brain and complement the physiological changes there intensifying them and extending their duration  when you notice body sensations you worry about what they might mean for your physical andor psychological wellbeing the trigger stimulus does not have to be an external stimulus but can be an internal one as some people are particularly sensitive to body signals  thoughts and memories may lead to you to worry about your physical andor psychological wellbeing we do not need to be presence of an external or internal stimulus to be anxious an episodic memory of a past trauma or of a panic attack in the past is sufficient to activate the defence circuits  thoughts and memories may result in existential dread such as worry about leading a meaningful life or the eventuality of death examples are contemplations of whether ones life has been meaningful the inevitability of death or the difficulty of making decisions that have a moral value these do not necessarily activate defensive systems they are more or less pure forms of cognitive anxiety comorbidity anxiety disorders often occur with other mental health disorders particularly major depressive disorder bipolar disorder eating disorders or certain personality disorders it also commonly occurs with personality traits such as neuroticism this observed cooccurrence is partly due to genetic and environmental influences shared between these traits and anxiety it is common for those with obsessivecompulsive disorder to experience anxiety anxiety is also commonly found in those who experience panic disorders phobic anxiety disorders severe stress dissociative disorders somatoform disorders and some neurotic disorders anxiety has also been linked to the experience of intrusive thoughts studies have revealed that individuals who experience high levels of anxiety also known as clinical anxiety are highly vulnerable to the experience of intense intrusive thoughts or psychological disorders that are characterised by intrusive thoughts risk factors anxiety disorders are partly genetic with twin studies suggesting 3040 genetic influence on individual differences in anxiety environmental factors are also important twin studies show that individualspecific environments have a large influence on anxiety whereas shared environmental influences environments that affect twins in the same way operate during childhood but decline through adolescence specific measured environments that have been associated with anxiety include child abuse family history of mental health disorders and poverty anxiety is also associated with drug use including alcohol caffeine and benzodiazepines which are often prescribed to treat anxiety neuroanatomy neural circuitry involving the amygdala which regulates emotions like anxiety and fear stimulating the hpa axis and sympathetic nervous system and hippocampus which is implicated in emotional memory along with the amygdala is thought to underlie anxiety people who have anxiety tend to show high activity in response to emotional stimuli in the amygdalanolenhoeksema s 2013 abnormal psychology 6th edition mcgraw hill some writers believe that excessive anxiety can lead to an overpotentiation of the limbic system which includes the amygdala and nucleus accumbens giving increased future anxiety but this does not appear to have been proven research upon adolescents who as infants had been highly apprehensive vigilant and fearful finds that their nucleus accumbens is more sensitive than that in other people when deciding to make an action that determined whether they received a reward this suggests a link between circuits responsible for fear and also reward in anxious people as researchers note a sense of responsibility or selfagency in a context of uncertainty probabilistic outcomes drives the neural system underlying appetitive motivation ie nucleus accumbens more strongly in temperamentally inhibited than noninhibited adolescents  the gutbrain axis  the microbes of the gut can connect with the brain to affect anxiety there are various pathways along which this communication can take place one is through the major neurotransmitters the gut microbes such as bifidobacterium and bacillus produce the neurotransmitters gaba and dopamine respectively the neurotransmitters signal to the nervous system of the gastrointestinal tract and those signals will be carried to the brain through the vagus nerve or the spinal system this is demonstrated by the fact that altering the microbiome has shown anxiety and depressionreducing effects in mice but not in subjects without vagus nerves another key pathway is the hpa axis as mentioned above the microbes can control the levels of cytokines in the body and altering cytokine levels creates direct effects on areas of the brain such as the hypothalamus the area that triggers hpa axis activity the hpa axis regulates production of cortisol a hormone that takes part in the bodys stress response when hpa activity spikes cortisol levels increase processing and reducing anxiety in stressful situations these pathways as well as the specific effects of individual taxa of microbes are not yet completely clear but the communication between the gut microbiome and the brain is undeniable as is the ability of these pathways to alter anxiety levels with this communication comes the potential to treat anxiety prebiotics and probiotics have been shown to reduce anxiety for example experiments in which mice were given fructo and galactooligosaccharide prebiotics and lactobacillus probiotics have both demonstrated a capability to reduce anxiety in humans results are not as concrete but promising genetics genetics and family history eg parental anxiety may put an individual at increased risk of an anxiety disorder but generally external stimuli will trigger its onset or exacerbation estimates of genetic influence on anxiety based on studies of twins range from 25 to 40 depending on the specific type and agegroup under study for example genetic differences account for about 43 of variance in panic disorder and 28 in generalized anxiety disorder longitudinal twin studies have shown the moderate stability of anxiety from childhood through to adulthood is mainly influenced by stability in genetic influence when investigating how anxiety is passed on from parents to children it is important to account for sharing of genes as well as environments for example using the intergenerational childrenoftwins design many studies in the past used a candidate gene approach to test whether single genes were associated with anxiety these investigations were based on hypotheses about how certain known genes influence neurotransmitters such as serotonin and norepinephrine and hormones such as cortisol that are implicated in anxiety none of these findings are well replicated with the possible exception of tmem132d comt and maoa the epigenetic signature of bdnf a gene that codes for a protein called brain derived neurotrophic factor that is found in the brain has also been associated with anxiety and specific patterns of neural activity and a receptor gene for bdnf called ntrk2 was associated with anxiety in a large genomewide investigation the reason that most candidate gene findings have not replicated is that anxiety is a complex trait that is influenced by many genomic variants each of which has a small effect on its own increasingly studies of anxiety are using a hypothesisfree approach to look for parts of the genome that are implicated in anxiety using big enough samples to find associations with variants that have small effects the largest explorations of the common genetic architecture of anxiety have been facilitated by the uk biobank the angst consortium and the crc fear anxiety and anxiety disorders medical conditions many medical conditions can cause anxiety this includes conditions that affect the ability to breathe like copd and asthma and the difficulty in breathing that often occurs near death conditions that cause abdominal pain or chest pain can cause anxiety and may in some cases be a somatization of anxiety the same is true for some sexual dysfunctions conditions that affect the face or the skin can cause social anxiety especially among adolescents and developmental disabilities often lead to social anxiety for children as well lifethreatening conditions like cancer also cause anxiety furthermore certain organic diseases may present with anxiety or symptoms that mimic anxiety these disorders include certain endocrine diseases hypo and hyperthyroidism hyperprolactinemia metabolic disorders diabetes deficiency states low levels of vitamin d b2 b12 folic acid gastrointestinal diseases celiac disease nonceliac gluten sensitivity inflammatory bowel disease heart diseases blood diseases anemia cerebral vascular accidents transient ischemic attack stroke and brain degenerative diseases parkinsons disease dementia multiple sclerosis huntingtons disease among others substanceinduced several drugs can cause or worsen anxiety whether in intoxication withdrawal or as side effect these include alcohol tobacco sedatives including prescription benzodiazepines opioids including prescription pain killers and illicit drugs like heroin stimulants such as caffeine cocaine and amphetamines hallucinogens and inhalants while many often report selfmedicating anxiety with these substances improvements in anxiety from drugs are usually shortlived with worsening of anxiety in the long term sometimes with acute anxiety as soon as the drug effects wear off and tend to be exaggerated acute exposure to toxic levels of benzene may cause euphoria anxiety and irritability lasting up to 2 weeks after the exposure psychological poor coping skills eg rigidityinflexible problem solving denial avoidance impulsivity extreme selfexpectation negative thoughts affective instability and inability to focus on problems are associated with anxiety anxiety is also linked and perpetuated by the persons own pessimistic outcome expectancy and how they cope with feedback negativity temperament eg neuroticism and attitudes eg pessimism have been found to be risk factors for anxiety cognitive distortions such as overgeneralizing catastrophizing mind reading emotional reasoning binocular trick and mental filter can result in anxiety for example an overgeneralized belief that something bad always happens may lead someone to have excessive fears of even minimally risky situations and to avoid benign social situations due to anticipatory anxiety of embarrassment in addition those who have high anxiety can also create future stressful life events together these findings suggest that anxious thoughts can lead to anticipatory anxiety as well as stressful events which in turn cause more anxiety such unhealthy thoughts can be targets for successful treatment with cognitive therapy psychodynamic theory posits that anxiety is often the result of opposing unconscious wishes or fears that manifest via maladaptive defense mechanisms such as suppression repression anticipation regression somatization passive aggression dissociation that develop to adapt to problems with early objects eg caregivers and empathic failures in childhood for example persistent parental discouragement of anger may result in repressionsuppression of angry feelings which manifests as gastrointestinal distress somatization when provoked by another while the anger remains unconscious and outside the individuals awareness such conflicts can be targets for successful treatment with psychodynamic therapy while psychodynamic therapy tends to explore the underlying roots of anxiety cognitive behavioral therapy has also been shown to be a successful treatment for anxiety by altering irrational thoughts and unwanted behaviors evolutionary psychology an evolutionary psychology explanation is that increased anxiety serves the purpose of increased vigilance regarding potential threats in the environment as well as increased tendency to take proactive actions regarding such possible threats this may cause false positive reactions but an individual with anxiety may also avoid real threats this may explain why anxious people are less likely to die due to accidents there is ample empirical evidence that anxiety can have adaptive value within a school timid fish are more likely than bold fish to survive a predator when people are confronted with unpleasant and potentially harmful stimuli such as foul odors or tastes petscans show increased blood flow in the amygdala in these studies the participants also reported moderate anxiety this might indicate that anxiety is a protective mechanism designed to prevent the organism from engaging in potentially harmful behaviors social social risk factors for anxiety include a history of trauma eg physical sexual or emotional abuse or assault bullying early life experiences and parenting factors eg rejection lack of warmth high hostility harsh discipline high parental negative affect anxious childrearing modelling of dysfunctional and drugabusing behaviour discouragement of emotions poor socialization poor attachment and child abuse and neglect cultural factors eg stoic familiescultures persecuted minorities including those with disabilities and socioeconomics eg uneducated unemployed impoverished although developed countries have higher rates of anxiety disorders than developing countries  a 2019 comprehensive systematic review of over 50 studies showed that food insecurity in the united states is strongly associated with depression anxiety and sleep disorders foodinsecure individuals had an almost 3 fold risk increase of testing positive for anxiety when compared to foodsecure individuals gender socialization contextual factors that are thought to contribute to anxiety include gender socialization and learning experiences in particular learning mastery the degree to which people perceive their lives to be under their own control and instrumentality which includes such traits as selfconfidence selfefficacy independence and competitiveness fully mediate the relation between gender and anxiety that is though gender differences in anxiety exist with higher levels of anxiety in women compared to men gender socialization and learning mastery explain these gender differences treatment the first step in the management of a person with anxiety symptoms involves evaluating the possible presence of an underlying medical cause the recognition of which is essential in order to decide the correct treatment anxiety symptoms may mask an organic disease or appear associated with or as a result of a medical disorder cognitive behavioral therapy cbt is effective for anxiety disorders and is a first line treatment cbt appears to be equally effective when carried out via the internet while evidence for mental health apps is promising it is preliminary psychopharmacological treatment can be used in parallel to cbt or can be used alone as a general rule most anxiety disorders respond well to firstline agents such drugs also used as antidepressants are the selective serotonin reuptake inhibitors and serotoninnorepinephrine reuptake inhibitors that work by blocking the reuptake of specific neurotransmitters and resulting in the increase in availability of these neurotransmitters additionally benzodiazepines are often prescribed to individuals with anxiety disorder benzodiazepines produce an anxiolytic response by modulating gaba and increasing its receptor binding a third common treatment involves a category of drug known as serotonin agonists this category of drug works by initiating a physiological response at 5ht1a receptor by increasing the action of serotonin at this receptor other treatment options include pregabalin tricyclic antidepressants and moclobemide among others prevention the above risk factors give natural avenues for prevention a 2017 review found that psychological or educational interventions have a small yet statistically significant benefit for the prevention of anxiety in varied population types pathophysiology anxiety disorder appears to be a genetically inherited neurochemical dysfunction that may involve autonomic imbalance decreased gabaergic tone allelic polymorphism of the catecholomethyltransferase comt gene increased adenosine receptor function increased cortisol in the central nervous system cns the major mediators of the symptoms of anxiety disorders appear to be norepinephrine serotonin dopamine and gammaaminobutyric acid gaba other neurotransmitters and peptides such as corticotropinreleasing factor may be involved peripherally the autonomic nervous system especially the sympathetic nervous system mediates many of the symptoms increased flow in the right parahippocampal region and reduced serotonin type 1a receptor binding in the anterior and posterior cingulate and raphe of patients are the diagnostic factors for prevalence of anxiety disorder the amygdala is central to the processing of fear and anxiety and its function may be disrupted in anxiety disorders anxiety processing in the basolateral amygdala has been implicated with expansion of dendritic arborization of the amygdaloid neurons sk2 potassium channels mediate inhibitory influence on action potentials and reduce arborization  see also  list of people with an anxiety disorder      references   external links      categoryemotions'
    # print('Querying data...')
    # queried_res = sumdb.query(query)
    # with open("debug/sumdb_queried_res2.json", "a") as f:
        # json.dump(queried_res, f)
    # print(sumdb.query(query))

    # print('Querying all data...')
    # print(sumdb.query_all())

    print('Final cleanup...')
    sumdb.delete_all()

    print(f'Total time: {time.perf_counter() - start:.2f} seconds')
